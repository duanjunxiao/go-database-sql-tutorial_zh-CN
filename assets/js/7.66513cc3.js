(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{189:function(e,o,n){"use strict";n.r(o);var t=n(0),_=Object(t.a)({},function(){var e=this,o=e.$createElement,n=e._self._c||o;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("p",[n("code",[e._v("database/sql")]),e._v("包中有一个基础的连接池,但并没有很好的方法去控制和监控它,然而下面的一些知识还是会对你有所帮助:")]),e._v(" "),n("ul",[n("li",[e._v('连接池意味着在一个数据库中执行两个连续的语句时,可能会打开两个连接并分别执行它们.这是程序员相当常见的困惑,"为什么他们的代码执行不正确".例如,'),n("code",[e._v("LOCK TABLES")]),e._v("后紧跟的一个"),n("code",[e._v("INSERT")]),e._v("操作会被阻塞,因为"),n("code",[e._v("INSERT")]),e._v("是在一个没有持有表锁的连接上.")]),e._v(" "),n("li",[e._v("在需要时,且当前池中没有可用的连接时,连接池会新建连接.")]),e._v(" "),n("li",[e._v('默认时,连接池没有数量限制.如果你试图一次做很多事时,你可以创建任意数量的连接.这可能会导致数据库返回像"too many connections."这样的错误.')]),e._v(" "),n("li",[e._v("在Go1.1及以后版本中,可使用"),n("code",[e._v("db.SetMaxIdleConns(N)")]),e._v("来限制连接池中空闲连接的数量.但这不会限制连接池的大小.")]),e._v(" "),n("li",[e._v("在Go1.2.1及更新版本中,可"),n("code",[e._v("db.SetMaxOpenConns(N)")]),e._v("来限制连接池中可用连接的数量. 但在1.2版本中使用"),n("code",[e._v("db.SetMaxOpenConns(N)")]),e._v("会碰到一个"),n("a",{attrs:{href:"https://groups.google.com/d/msg/golang-dev/jOTqHxI09ns/x79ajll-ab4J",target:"_blank",rel:"noopener noreferrer"}},[e._v("死锁bug"),n("OutboundLink")],1),e._v(" ("),n("a",{attrs:{href:"https://code.google.com/p/go/source/detail?r=8a7ac002f840",target:"_blank",rel:"noopener noreferrer"}},[e._v("fix"),n("OutboundLink")],1),e._v(").")]),e._v(" "),n("li",[e._v("连接的回收速度相当快.通过将"),n("code",[e._v("db.SetMaxIdleConns(N)")]),e._v("设置为一个较高值可以缓解这个现象,有助于连接的复用.")]),e._v(" "),n("li",[e._v("保持空闲连接过久会碰到问题(比如在微软Azure上的MySQL上的这个"),n("a",{attrs:{href:"https://github.com/go-sql-driver/mysql/issues/257",target:"_blank",rel:"noopener noreferrer"}},[e._v("issue"),n("OutboundLink")],1),e._v(").如果你遇到由于连接空闲太久而引发超时时,试试"),n("code",[e._v("db.SetMaxIdleConns(0)")]),e._v(".")]),e._v(" "),n("li",[e._v("你也可以通过"),n("code",[e._v("db.SetConnMaxLifetime(duration)")]),e._v("来设置连接的超时时间(时间应小于数据库配置的连接超时时间),因为重用已长期存在的连接可能会导致网络问题.该参数会延迟关闭未使用的连接,即关闭已超时的连接可能会延迟.")])])])},[],!1,null,null,null);o.default=_.exports}}]);